<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tab Idle Timer</title>
    <style>
        /* HTML: <div class="loader"></div> */
        .loader {
            width: 45px;
            aspect-ratio: .75;
            --c: no-repeat linear-gradient(#000 0 0);
            background:
                var(--c) 0% 50%,
                var(--c) 50% 50%,
                var(--c) 100% 50%;
            animation: l7 1s infinite linear alternate;
        }

        @keyframes l7 {
            0% {
                background-size: 20% 50%, 20% 50%, 20% 50%
            }

            20% {
                background-size: 20% 20%, 20% 50%, 20% 50%
            }

            40% {
                background-size: 20% 100%, 20% 20%, 20% 50%
            }

            60% {
                background-size: 20% 50%, 20% 100%, 20% 20%
            }

            80% {
                background-size: 20% 50%, 20% 50%, 20% 100%
            }

            100% {
                background-size: 20% 50%, 20% 50%, 20% 50%
            }
        }
    </style>
</head>

<body>

    <!-- <h1>Tab Idle Timer Demo</h1>
    <p>Switch to another tab. After 10 minutes, come back to this tab and you will get an alert.</p> -->

    <div class="loader"></div>


    <script>
        let dctitle = document.title;
        let startTime;
        const IDLE_TIME_LIMIT = 10 * 60 * 1000; // 10 minutes in milliseconds

        // Function to handle when the tab loses focus
        function handleTabBlur() {
            startTime = new Date().getTime();
            console.log('Tab blurred. Timer started at:', new Date(startTime));
            showTimer();
        }

        let timerInterval;
        function showTimer() {
            timerInterval = setInterval(() => {
                const currentTime = new Date().getTime();
                const elapsedTime = currentTime - startTime;

                // convert milliseconds to 00:00:00 for display 
                const hours = Math.floor(elapsedTime / (1000 * 60 * 60));
                const minutes = Math.floor((elapsedTime % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((elapsedTime % (1000 * 60)) / 1000);
                const formattedTime = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                console.log('Timer:', formattedTime);
                // Update the document title with the elapsed time
                document.title = `${formattedTime} - ${dctitle}`;
                // document.title = formattedTime + title;
            }, 1000); // Log every second 
        }
        function stopTimer() {
            clearInterval(timerInterval);
            console.log('Timer stopped');
        }

        // Function to handle when the tab regains focus
        function handleTabFocus() {
            document.title = dctitle;
            if (startTime) {
                stopTimer();
                const endTime = new Date().getTime();
                const idleDuration = endTime - startTime;
                console.log('Tab focused. Timer stopped. Idle duration:', idleDuration, 'ms');

                if (idleDuration >= IDLE_TIME_LIMIT) {
                    const minutes = Math.floor(idleDuration / (1000 * 60));
                    // alert(`You have been away for more than 10 minutes. Idle time: ${minutes} minutes.`);
                    confirm("Need Refresh?") ? location.reload() : null;
                }

                // Reset the timer
                startTime = null;
            }
        }

        // Add event listeners for focus and blur events
        window.addEventListener('blur', handleTabBlur);
        window.addEventListener('focus', handleTabFocus);

        console.log('Tab idle timer script loaded.');
    </script>

</body>

</html>